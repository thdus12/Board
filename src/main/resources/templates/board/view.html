<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout/default_layout">
   	<!-- layout Content -->
	<th:block layout:fragment="content">
		<div class="container">
			<div class="card-header mb-3">
		    	<h3 class="text-center font-weight-bold my-4">Board View.</h3>
		    </div>
			<form id="frm" action="/board/edit" method="get" th:with="info=${resultMap.info}" enctype="multipart/form-data">
				<input type="hidden" name="id" th:value="${info.id}">
				<div class="mb-3">
				    <span class = "font-weight-bold" name="title" th:text="${info.title}"></span>				    
				</div>		
				<div class="board-id mb-3 d-flex justify-content-between">
					<span>
						<span class = "text-secondary" name="registerId" th:text="${info.registerId} + ' | '"></span>
						<span class = "text-secondary" name="registerTime" th:text="${#temporals.format(info.registerTime, 'yyyy-MM-dd HH:mm:ss')}"></span>
					</span>
					<span class="flex-grow-1 text-right" th:text="'view : ' + ${info.readCnt}"></span>
				</div>
				<hr>
				<div class="mb-5">
			    	<pre name="content" th:utext="${info.content}"></pre>
				</div>
				<hr>
				<div class="clearfix mt-3">
					<div class="d-flex align-items-center">
					    <button type="button" class="btn btn-success" onclick="javascript:location.href='/board/list'">Previous</button>
					    <div class="ml-auto"></div>
					    <button type="button" class="btn btn-primary mr-1" onclick="fnViewEdit('${info.id}')">Edit</button>
					    <button type="button" class="btn btn-danger" th:onclick="fnViewDelete()">Delete</button>
					</div>
				</div>
			</form>
			<hr>
			<div class="mt-5">			    
			   	<label class="form-label font-weight-bold">Comment.</label>
			    <hr>
			    <div th:each="comment : ${commentList}" th:if="${comment.parentId} == 0">
			        <div class="comment">
			            <span class="font-weight-bold" th:text="${comment.registerId} + ' | '"></span>
			            <span class="text-secondary" th:text="${#temporals.format(comment.registerTime, 'yyyy-MM-dd HH:mm:ss')}"></span>
			            <p class="mt-2" th:text="${comment.content}"></p>
			        </div>
			        <hr>
			    </div>
			</div>			
			<form id="commentForm" th:action="@{/board/view/comment}" th:with="info=${resultMap.info}" method="post">
			    <input type="hidden" name="boardId" th:value="${info.id}" />
			    <input type="hidden" name="registerId" th:value="${userEmail}"/>
			    <div class="mb-6">
			        <textarea class="form-control" rows="3" name="content"></textarea>
			        <button type="button" class="btn float-right" onclick="fnCommentAdd()">Add</button>
			    </div>
			</form>
		</div>
	    <script th:inline="javascript">
    		let frm = $("#frm");
    		let comment = $("#commentForm");
    		
		    function fnViewDelete() {
	            if (confirm("Do you want to delete it?")) {
	                frm.attr("action", "/board/view/delete");
					frm.attr("method","post");
					frm.submit();
	            }
	        }
		    
		    function fnViewEdit(id) {
		        if (confirm("Do you want to edit it?")) {
		            $("#id").val(id);
		            frm.submit();
		        }
	        }
		    
		    function fnCommentAdd() {		    	
		    	comment.submit();
		    }
		    
		    $(function() {
		    	frm.validate({
		        	messages: {
					   	title: {
					     	required : "title is required, Please enter a title."
					   	},
					   	content: {
					   		required : "content is required, Please enter a content."
						},
						registerId: {
					    	required : "writer is required, Please enter a writer."
						}		   
			        },
			        submitHandler: function (form) {
			            form.submit();
			        }
		      	});
	        });
		</script>
	</th:block>
</html>